{% extends 'my_app/tigram/top_band_cont.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" href="css/form1.css"> -->
    <link rel="stylesheet" href="{% static 'css/form1.css' %}">
    <script src="{% static 'js/jquery-3.6.0.js' %}"></script>
    <!-- <link rel="stylesheet" href="css/dash.css"> -->
    <!-- <link rel="stylesheet" href="{% static 'css/dash.css' %}"> -->
    <!-- <link rel="stylesheet" href="{% static 'css/viewapplication.css' %}"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href='https://fonts.googleapis.com/css?family=Salsa' rel='stylesheet'>
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    >
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"
      integrity="sha512-2ImtlRlf2VVmiGZsjm9bEyhjGW4dU7B6TNwh/hx/iSByxNENtj3WVE6o/9Lj4TJeVXPi4bnOIMXFIJJAeufa0A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="{% static 'js/repeater.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js"></script>
     <script>
 function NumberCheck(input) {
            ////debugger;
            let value = input.value;
            let numbers = value.replace(/[^0-9]/g, "");
            input.value = numbers;
        }
</script>

    <style>
        #myModal2 {
  display: none;
  position: absolute;
  z-index: 1;
  padding-top: 130px;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  /*background-color: black;*/
    z-index:100;
}
#map_content {
  display: none;
  position: absolute;
  z-index: 1;
  /*padding-top: 130px;*/
  left: 5%;
  top: 130px;
  width: 90%;
  align-self: center;
  height: 90%;
  overflow: auto;
  /*background-color: black;*/
    z-index:100;
}
.cursor {
  cursor: pointer;
}
#myModal2content{
     position: relative;
  background-color: greenyellow;
  margin: auto;
  padding: 0;
  width: 30%;
  max-width: 1200px;
}
/* Modal Content */
.myModal3content{
  position: relative;
  /*background-color: greenyellow;*/
  margin: auto;
  padding: 0;
  
}

/* The Close Button */
.close {
  color: white;
  position: absolute;
  top: 10px;
  right: 25px;
  font-size: 35px;
  font-weight: bold;
}
#update-btn:hover {
  /*color:#fff;
  background: white;*/
}

.close:hover,
.close:focus {
  color: #999;
  text-decoration: none;
  cursor: pointer;
}/*
		.nav{
		position:fixed;
		width:100%;
		}*/
        #tab {
            display: none;
            color: #000;
            position: relative;
           padding:10px;
		   margin:10px 0px;
            margin-top: 5px;
        }

        #veh {
            display: none;
            color: #000;
            position: relative;
            padding: 10px;
            margin-top: 5px;
        }
		.add_log{
		background:#fff;
		}
		.add_log thead{
		margin-bottom:5px;
		padding-bottom:5px;
		}
		.add_log thead td{
		text-transform:initial;
		padding-left:5px;
		    font-size: 14px;
    font-weight: 600;
	padding-bottom:5px;
		}
		.add_log input{
		margin:0px !important;
		padding:5px 7px !important;
		border:none;
		outline:none !important;
		}
		.add_log select{
		padding:5px 7px !important;
		border:none;
		outline:none !important;
		}
		.add_log tbody{
		border:1px solid #ccc;
		}
		.add_log tbody td{
		padding:0px !important;
		margin-right:10px;
		border:1px solid #ccc;
		}
		
		.add_log table{
		border-spacing:0px;
		}
		
		.nice_scroll::-webkit-scrollbar {
  width: 10px;
}

/*.nice_scroll::-webkit-scrollbar-track {
  background: #fff;
}

.nice_scroll::-webkit-scrollbar-thumb {
  background: #a7a7a7;
}*/

#addbutton{
margin-left:10px;
margin-right:10px;
background:#6174ff;
border-radius:0px;
width:20px;
height:20px;
border:none;
outline:none;
color:#fff;
}
.remove_btn button{
background:black;
color:#fff;
margin-left:10px;
border-radius:none;
width:20px;
height:20px;
border:none;
outline:none;
}
.form{
padding-top:90px;
}
.file_upload{
margin-bottom:20px;
}
/*.file_upload label{
width:200px;
display:inline-block;

}*/
.file_upload label{
width:200px;
display:inline-block;

}
.file_upload input[type="file"]::-webkit-file-upload-button {
  background: #fff;
  color:#222;
  padding:5px 15px;
  margin:0px 10px;
  border:1px solid #aaa; 
  cursor:pointer;
  width: 130px;
}
.file_upload input[type="file"]::-webkit-file-upload-button:hover {
  background: #000;
  color:#fff;
}

.view_log .tbl_head{
background:#444;
display:flex;
}
.view_log .tbl_head .txt{
width:calc(100% / 7);
padding-left:10px;
padding-bottom:5px;
font-size:16px;
font-weight:600;
color:#fff;
}
.view_log .tbl_head .txt.serial{
width:55px;
}
.view_log .tbl_head .txt.species{
width:200px;
}
.view_log .tbl_body{
background:#fff;
}
.view_log .tbl_body .row{
display:flex;
border-bottom:1px solid #ccc;
}
.view_log .tbl_body .cell{
width:calc(100% / 7);
padding-left:10px;
font-size:16px;
line-height:24px;
padding:10px;
}
.view_log .tbl_body .cell.serial{
width:50px;
}
.view_log .tbl_body .cell.species{
width:205px !important;
}

.personal_details hr{
	margin-bottom:15px;
}
.personal_details input,.personal_details select{
    margin: 0px 0;
	margin-bottom:0px;
	padding: 8px 12px;
	outline:none;
}
.personal_details label{

display:block;}

.tree_check label{
font-size:16px;
line-height:16px;
font-weight:600;
}
.tree_check input[type="checkbox"]{
font-size:16px;
width:16px;
height:16px;
margin-right:5px;

}
.required:after {
    content:" *";
    color: red;
  }
#snackbar {
  visibility: hidden;
  min-width: 250px;
  margin-left: -125px;
  /*background-color: #333;*/
  background-color: #fff;
  color: #fff;
  text-align: center;
  border-radius: 2px;
  padding: 16px;
  position: fixed;
  z-index: 1;
  left: 50%;
  /*bottom: 30px;*/
  top: 140px;
  font-size: 17px;
}

#snackbar.show {
  visibility: visible;
  -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
  animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

/*@-webkit-keyframes fadein {
  from {bottom: 0; opacity: 0;} 
  to {bottom: 30px; opacity: 1;}
}*/

@-webkit-keyframes fadein {
  from {top: 0; opacity: 0;} 
  to {top: 140px; opacity: 1;}
}

@keyframes fadein {
/*  from {bottom: 0; opacity: 0;}
  to {bottom: 30px; opacity: 1;}*/
  from {top: 0; opacity: 0;}
  to {top: 140px; opacity: 1;}
}

/*@-webkit-keyframes fadeout {
  from {bottom: 30px; opacity: 1;} 
  to {bottom: 0; opacity: 0;}

}*/
@-webkit-keyframes fadeout {
  from {top: 140px; opacity: 1;} 
  to {top: 0; opacity: 0;}
  
}

@keyframes fadeout {
/*  from {bottom: 30px; opacity: 1;}
  to {bottom: 0; opacity: 0;}*/
  from {top: 140px; opacity: 1;}
  to {top: 0; opacity: 0;}
}
#dist select2 selection select2-selection{
width:98.7% !important;
}
#dist select2 selection select2-selection select2-selection__rendered {
right: 11px !important;
}
.cancel{
	background:#f44336;
	font-size:18px;
	color:#ffff;
	font-family: 'Roboto', sans-serif;
	float:right;
}
    </style>
</head>

<body style="overflow-y:hidden;">


        {% if messages %}
        <!-- <ul > -->
        {% for message in messages %}
        {% if message.tags == "success" %}
    <div id="snackbar" style="background-color:green;"><b><i class="fa fa-check" style="font-size:23px;color:white"></i>{{message}}</b></div>
    {% elif message.tags == "error"%}
    <div id="snackbar" style="background-color:red;"><b><i class="fa fa-times-circle" style="font-size:23px;color:white"></i>{{message}}</b></div>
    {% elif message.tags == "warning"%}
    <div id="snackbar" style="background-color:#ffc107;"><b><i class="fa fa-exclamation-triangle" style="font-size:23px;color:white"></i>{{message}}</b></div>
    {% else %}
    <div id="snackbar" style="background-color:grey;"><b><i class="fa fa-home" style="font-size:23px"></i>Something Wrong!</b></div>
    {% endif %}

    {% endfor %}

    {% endif %}
    <form class="form cont nice_scroll" id="form1-form" action="{% url 'noc_application_form' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="container">
        <div class="content">
         <!-- <h1>Choose Division and Range</h1> -->

        <label for="division" class="required"><b>Administrative Forest Division:</b></label>
            <select name="division" id="div_sel" class="nothing" style="width: 200px;" required>
                                <option value="">Select Division</option>

                               {% for each in division_areas %}
                                    <option value="{{each.name}}" class="italize_species"> {{each.name}}</option>
                                {% endfor %}
                                    <!-- <option  class="italize_species"> Trivandrum</option> -->

                            </select>
            <br>

            <label for="area_range" class="required"><b>Administrative Forest Range:&nbsp;&nbsp;&nbsp;</b></label>
        <select name="area_range" id="ran_val" class="nothing" style="width: 200px;" required>
                                <option value="">Select Range</option>


        </select>
            <br>
        </div>
			<div class="personal_details">
            <h1>NOC Form</h1>

            <hr>

            <label for="uname" class="required"><b>Name:</b></label>
            <input type="text" style="height:30px;" placeholder="Enter your name" name="uname" onkeypress="return (event.charCode > 64 && event.charCode < 91) || (event.charCode > 96 && event.charCode < 123) || (event.charCode==32)" required>


            <label for="add" class="required"><b>Address:</b></label>
            <input type="text" style="height:30px;" placeholder="Enter your address" name="add" required>


            <label for="sno" class="required"><b>Survey Number:</b></label>
            <input type="text" style="height:30px;" placeholder="Enter your survey number" name="sno" required>
            <br>


            <label for="treep" class="required"><b>Number of trees proposed to be cut:</b></label>
            <input type="text" style="height:30px;" pattern="\d+" placeholder="Enter number of trees" id="treep" title="Only positive numbers allowed" name="treep" oninput="NumberCheck(this)" required>
            <br>
            <label for="dist" class="required"><b>District:</b></label>

            <select name="dist" id ="dist" class="dist" required>
                <option value="">Select District</option>
                {% for each in district_name %}
                    <option value="{{each.district_name}}" class="italize_species"> {{each.district_name}}</option>
                {% endfor %}
            </select>


            <br>


            <label for="taluka" class="required"><b>Taluka:</b></label>
            <!-- <input type="text" placeholder="Enter your Taluka" name="taluka" required> -->
            <select name="taluka" id ="taluka" class="taluka" required>
                                <option value="">Select Taluka</option>


            </select>
            <br>

            <label for="vil" class="required"><b>Village:</b></label>
            <!-- <input type="text" placeholder="Enter your Village" name="vil" required> -->
            <select name="village" id ="village" class="village" required>
                <option value="">Select village</option>


</select>

            <br>

            <label for="block" class=""><b>Block: (optional)</b></label>
            <input type="text" style="height:30px;" placeholder="Enter your Block" name="block" value="N/A">
            <br>


            <label for="pincode" class="required"><b>Pincode:</b></label>
            <input type="text" style="height:30px;" placeholder="Enter your Pincode" name="pincode" pattern="[1-9]{1}[0-9]{5}" title="qwert" oninvalid = "this.setCustomValidity(&apos;Please enter valid pincode&apos;)" oninput="NumberCheck(this)">
            <br>
		</div>



            <div id='chk_div' class="tree_check">
                <b class="required">Species of tree or trees proposed to be cut:</b>

               <table>


                {% for each_speci in trees_species %}

                {% if forloop.counter0|divisibleby:3  %}<tr >{% endif %}
                <td style="width: 300px;">
                <input type="checkbox" id="s{{forloop.counter}}" name="species{{forloop.counter}}" class="chk_species" data-name="{% ifequal each_speci.name 'Other' %}other-species-chk{% else %}species-name{% endifequal %}" value="{{each_speci.name}}" oninvalid="this.setCustomValidity('Please select any one of the tree species!')" onchange="this.setCustomValidity('')" required>
                <label for="s{{forloop.counter}}" class="italize_species"> {{each_speci.name}}</label>
                </td>
                <!-- <br> -->
                {% if forloop.counter|divisibleby:3  %}</tr>{% endif %}
                {% endfor %}
                </table>
                <div id="other-species-div">

                <input type="text" style="height:30px;" name="other-species" class="other-species-input" id="other-species" placeholder="Enter Species Name" value="">
                <!-- <button type="button" class="save btn" id="add_species">Add Species</button> -->
                </div>

                <input type="hidden" name="tree_species" id="tree_species" value="">
            </div>

			    <div class="personal_details">
            <label for="propt" class="required"><b>Purpose for which trees or trees proposed to be cut:</b></label>
            <input type="text" style="height:30px;" placeholder="Enter Purpose for which trees or trees proposed to be cut" name="purpose_cut" required>
			</div>

            <label for="s9" class="required"><b>Trees have been cut  ?</b></label><br>
            <input type="radio" name="trees_cut" value="yes" required>
            <label for="yes">Yes</label><br>
            <input type="radio" name="trees_cut" value="no">
            <label for="no">No</label><br>
            <div id="display_log_details">

            <label for="s9" class="required"><b>Would you like to enter the log details?</b></label><br>
            <input type="radio" id="yes" name="log_option" value="yes" >
            <label for="yes">Yes</label><br>
            <input type="radio" id="no" name="log_option" value="no">
            <label for="no">No</label><br>


	<br/>
    <p class="error_filldetails"></p>
            <div id="tab" class="add_log nice_scroll" style="height:258px; overflow: auto;">
                <table id="myTable" >
                    <thead>
                    <!-- <tr> -->
                        <td style="text-align: center;">
                            Sr.No
                        </td>
                        <td style="text-align: center;">
                            Species

                        </td>
                        <td style="text-align: center;">
                            Height(m)
                        </td>
                        <td style="text-align: center;">
                            GDH(cm)
                        </td>

                        <td style="text-align: center;">
							Volume(cm<sup>3</sup>)
                        </td>


                    <!-- </tr> -->
                    </thead>
                    <tbody id='myBody'>
                    <tr >
                        <!-- <td><input id="cid" type="float" placeholder=""></td> -->
                        <td style="text-align: center;"><label class="sr_no">1</label></td>
                        <td style="text-align: center;"><select style="text-align: center;" name="species[]" id="cid1" class="species" required>
                                <option>Select</option>
                                <!-- <option value="Sandal wood(Santalum album)">Sandal wood(Santalum album)</option> -->


                            </select></td>
                        <td style="text-align: center;"><input style="text-align: center;" id="cid2" name="length[]" type="text" class="length" pattern="\d+(\.\d{1,2})?" title="Please enter valid length" placeholder="" oninput="NumberCheck(this)" required></td>
                        <td style="text-align: center;"><input style="text-align: center;" id="cid3" name="breadth[]" type="text" class="breadth" pattern="\d+(\.\d{1,2})?" title="Please enter valid breadth" placeholder="" oninput="NumberCheck(this); validateBreadth(this);" onblur="validateBreadth(this);" required></td>
                        <td style="text-align: center;display:none"><input style="text-align: center;" id="cid4" name="volume[]" type="text" class="volume" placeholder="" oninput="NumberCheck(this)"></td>



                        <td style="text-align: center;"><button style="font-size:14px" id="addbutton" ><i
                                    class="fa fa-plus" ></i></button></td>
                                    <!-- <td><button onclick="myCreateFunction()" style="font-size:20px" id="addbutton" ><i
                                    class="fa fa-plus-square-o" ></i></button></td> -->
                    </tr>
                    </tbody>
                </table>

            </div>
            </div>

            <script>
             function NumberCheck(input) {
            // debugger;
            let value = input.value;
            let numbers = value.replace(/[^0-9]/g, "");
            input.value = numbers;
        }

                function getConfirmation(lat,lng) {

               swal({
                  title: "Are you sure?",
                  text: "Do you want to continue with selected "+lat+","+lng+"(Latitude,Longitude) ?",
                  icon: "warning",
                  buttons: true,
                  dangerMode: true,
                })
                .then((willDelete) => {
                  if (willDelete) {
                  closeModal3();
                    swal("Success!", {
                      icon: "success",
                    });
                  } else {
                    swal("Cancelled!");
                  }
                });
            }
                $(document).ready(function(){
                    $("#div_sel").select2();
                    $("#ran_val").select2();
                    $("#dist").select2();
                    $("#taluka").select2();
                    $("#village").select2();
                    $('#div_sel').on('change',function(e){
                        var range_area = $(this).val();
                            console.log(range_area);
                        if ($(this).val()==''){
                            $('#ran_val').val('');
                        }

                        $.ajax({
                            url: "../admin/load_division1/",
                            type:'GET',
                            'data':{
                                'range_area':range_area},
                            success: function(data){

                            console.log(data,"dataaaaa");
                            var lt = data.div_list.length
                            var temp = '<option value="">Select Range</option>'

                            $('#ran_val').empty();
                            for (i=0;i<lt;i++){
                                temp+='<option value=' + data.div_list[i].name + '>' + data.div_list[i].name + '</option>'
                            }
                            console.log(temp,'$$$$$$$$$$$$$$$$$$$$$$$$')
                            $('#ran_val').append(temp);

                        // alert(data.message);
                        // location.reload(true);
                        }});

                    })


                    $('#taluka').on('change',function(e){
                        var taluka = $(this).val();
                        if ($(this).val()==''){
                            $('#village').val('');
                        }
                        // $.ajax()
                        $.ajax({
                            url: "../admin/load_village/",
                            type:'GET',
                            'data':{
                                'taluka':taluka},
                            success: function(data){
                        // console.log(result,"45654555555555555");
                            // console.log(data);
                            var lt = data.div_list.length
                            // console.log(lt,"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@")
                            // $('#taluka').val(data.div_list[0].taluka_name);


                            var temp = '<option value="">Select Village</option>'
                            // $('#taluka').val(data.div_list[0].taluka_name);
                            $('#village').empty();
                            for (i=0;i<lt;i++){
                                temp+='<option value=' + data.div_list[i].village_name + '>' + data.div_list[i].village_name + '</option>'
                            }
                            // console.log(temp,'$$$$$$$$$$$$$$$$$$$$$$$$')
                            $('#village').append(temp);

                        // alert(data.message);
                        // location.reload(true);
                        }});

                    })


                    $('#dist').on('change',function(e){
                        var dist = $(this).val();
                        if ($(this).val()==''){
                            $('#taluka').val('');
                        }
                        // $.ajax()
                        $.ajax({
                            url: "../admin/load_taluka/",
                            type:'GET',
                            'data':{
                                'dist':dist},
                            success: function(data){
                        // console.log(result,"45654555555555555");
                            console.log(data);
                            var lt = data.div_list.length
                            console.log(lt,"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@")
                            var temp = '<option value="">Select Taluka</option>'
                            // $('#taluka').val(data.div_list[0].taluka_name);
                            $('#taluka').empty();
                            for (i=0;i<lt;i++){
                                temp+='<option value=' + data.div_list[i].taluka_name + '>' + data.div_list[i].taluka_name + '</option>'
                            }
                            console.log(temp,'$$$$$$$$$$$$$$$$$$$$$$$$')
                            $('#taluka').append(temp);

                        // alert(data.message);
                        // location.reload(true);
                        }});

                    })





                    $('#range_sel').on('change',function(e){
                        var range_area = $(this).val();
                        if ($(this).val()==''){
                            $('#division_sel').val('');
                        }
                        // $.ajax()
                        $.ajax({
                            url: "../admin/load_division/",
                            type:'GET',
                            'data':{
                                'area_range':range_area},
                            success: function(data){
                        // console.log(result,"45654555555555555");
                            console.log(data.div_list[0].division_id__name);
                            $('#division_sel').val(data.div_list[0].division_id__name);
                            // $('#division_sel').attr('disabled',true);

                        // alert(data.message);
                        // location.reload(true);
                        }});

                    })
                    $('#division_sel').on('change',function(e){
                            // console.log('hhhhh');
                            $('#range_sel').val('');
                    })
                    $('.chk_species').on('change',function(){

                        if ($('.tree_check input:checkbox').filter(':checked').length < 1){


                             $('.chk_species').each(function() {
                            this.setCustomValidity('Please select any one of the tree species!');
                        });
                            $('.chk_species').attr('required', 'required');
                        }
                        else{

                            $('.chk_species').removeAttr('required');;
                            $('.chk_species').each(function() {
                            this.setCustomValidity('');
                        });
                        }
                    });
                    $('#display_log_details').hide();

                        var row_count = document.getElementById("myTable").rows.length;
                        var max_fields = 14;
                        var row='<tr class="rown" >\
                        <td style="text-align: center;"><label class="sr_no">'+row_count+'</label></td>\
                        <td style="text-align: center;"><select name="species[]" class="species sp3" required>\
                            </select></td>\
                        <td style="text-align: center;"><input style="text-align: center;" name="length[]" class="length" type="text" placeholder="" pattern="\\d+(\\.\\d{1,2})?" title="Please enter valid length" oninput="NumberCheck(this)" required></td>\
                        <td style="text-align: center;"><input style="text-align: center;" name="breadth[]" class="breadth" type="text" placeholder="" pattern="\\d+(\\.\\d{1,2})?" title="Please enter valid breadth" oninput="NumberCheck(this); validateBreadth(this);" onblur="validateBreadth(this);" required></td>\
                        <td style="text-align: center;display:none"><input style="text-align: center;" name="volume[]" class="volume" type="text" placeholder=""></td>\
                         <td class="remove_btn"><button style="font-size:14px"  >\
                        <i class="fa fa-minus"></i></button></td>\
                    </tr>';

                        $('#addbutton').click(function(e){
                                e.preventDefault();
                                var row_count = document.getElementById("myTable").rows.length;
                                console.log(row_count,"row_count")
                                var treepl=$('#treep').val();
                                 console.log(treepl,"treepl")
                                 if (treepl>=row_count)
                                 {
                                $("#myBody").append(row);
                                }
                                var $options = $("#cid1 > option").clone();
                                $('#myBody tr:last .sp3').append($options);
                                var addSerialNumber = function () {
                                $('#myBody tr').each(function(index) {
                                $(this).find('td:nth-child(1)').html(index+1);

                                });
                                };

                                addSerialNumber();
                        })
                        $(document).on('click','.remove_btn',function(e){
                            e.preventDefault();
                            // console.log(this);
                                $(this).parent().remove();
                        })

                });

            </script>
            <!-- <script type="text/javascript"></script> -->
            <script type="text/javascript">
                function log_required(){
                    $("[name='species[]']").prop("required",true);
                        $('.length').prop('required',true);
                        $('.breadth').prop('required',true);
                        $('.latitude').prop('required',true);
                        $('.longitude').prop('required',true);
                }
                function log_required_false(){
                    $("[name='species[]']").prop("required",false);
                        $('.length').prop('required',false);
                        $('.breadth').prop('required',false);
                        $('.latitude').prop('required',false);
                    $('.longitude').prop('required',false);
                }
                $(document).ready(function(){
                    $('#other-species-div').hide();
                    log_required_false();
                    $('input[name="option"]').on('click',function(e){
                    if($(this).val()=='yes')
                    {
                        $('.veh_details').prop('required',true);

                    }
                    else{
                        $('.veh_details').prop('required',false);
                    }
                    });
                    $('input[name="trees_cut"]').on('click',function(e){
                        // e.preventDefault();
                    if($(this).val()=='yes')
                    {
                        $('#display_log_details').show();
                        $('#yes').prop('required',true);

                    }
                    else{
                        $('#display_log_details').hide();
                        $('#yes').prop('required',false);
                        log_required_false();
                    }
                    });
                   $('#yes').click(function(){
                    $('#tab').show();
                    $("[name='species[]']").prop("required", true);
                    // $('.species').each(function(){
                    //         $(this).prop('required',true);
                    // });

                    // $('.species').prop('required',true);
                    $('.length').prop('required',true);
                    $('.breadth').prop('required',true);
                    $('.latitude').prop('required',true);
                        $('.longitude').prop('required',true);
                   });
                   $('#no').click(function(e){
                    // e.preventDefault();
                    $("[name='species[]']").prop("required", false);
                    // $('.species').each(function(){
                    //         $(this).prop('required',false);
                    // });
                    // $('.species').prop('required',false);
                    $('.length').prop('required',false);
                    $('.breadth').prop('required',false);
                    $('.latitude').prop('required',false);
                        $('.longitude').prop('required',false);
                      $('#tab').hide();
                   });
                });
                $("#repeater").createRepeater({
                showFirstItemToDefault: true,
                });

                $('#chk_div').on('change',function() {
                    var checked_values=[];
                    var spc=$('#other-species').val();
                    // alert(spc);
                    var isChecked = $('input:checkbox[data-name="other-species-chk"]').prop('checked') ? true : false;
                    // alert(isChecked);
                    if(isChecked==true){
                    //     alert('---check');
                    $('#other-species-div').show();
                        if($('#other-species').val() ){
                            $("input:checkbox[data-name='other-species-chk']:checked").attr('value',spc);
                        }
                        else{
                            $("input:checkbox[data-name='other-species-chk']").attr('value','Other');
                        }
                    }
                    else{
                    $('#other-species-div').hide();
                    $("input:checkbox[data-name='other-species-chk']").val('Other');
                    }
                    $("input:checkbox[class='chk_species']:checked").each(function () {
                    checked_values.push($(this).val());
                    // console.log(checked_values+"array");
                    $("#tree_species").val(checked_values);
                    });
                // $('.species').
                // createSelect(checked_values);
                $('.species').empty();
                $('.species').append('<option value="">Select</option>');
                    for (var index = 0; index < checked_values.length; index++) {
                        // console.log(checked_values+"list"+index);
                        $('.species').append('<option value="' + checked_values[index] + '" class="italize_species">' + checked_values[index] + '</option>');
                        }

                });


            </script>


			<div class="clearfix" style="clear:both;"></div>
			<br>
			<div class="view_log">
<!--				<div class="tbl_head">-->
<!--					<div class="txt serial">Sr.No</div><div class="txt species_txt">Species</div><div class="txt">Length</div><div class="txt">Breadth</div>-->
<!--					<div class="txt">Volume</div>-->
<!--				</div>-->
<!--				<div id="log_details" class="tbl_body nice_scroll" style="height:250px; overflow:auto;">-->
<!--					&lt;!&ndash; <div class="row">-->
<!--					<div class="cell serial">1</div><div class="cell species ">Teak (Tectona grandis)</div><div class="cell">487</div><div class="cell">17</div><div class="cell">16</div><div class="cell">123.456.789</div><div class="cell">987.654.321</div>-->
<!--					</div> &ndash;&gt;-->

<!--				</div>-->
			</div>




            <!-- try -->
            <div id="topBar">
                <!-- <a href ="#" id="load_home"> SHow Map </a> -->
            </div>
            <div id ="map_content1">
            </div>

            <script>

            $(document).ready( function() {
                $('#map_content1').hide();
                $(document).on('click','.map-btn',function(e){
                    // $('#map_content').show();
                    openModal3();
                    $('#latlng-val').val($(this).attr('data-target-val'));

                })


            });
            </script>


            <!-- try end -->
				<div class="file_upload">

           <label for="propt" class="required"><b>Select Photo Id Proof:</b></label>
            &nbsp;&nbsp;&nbsp;<select name="photo_proof_select" id="photo_proof_select" style="width: 130px;" required>
                    <option value="">Select Id Proof</option>

                    {% for each_proof in proof_list %}
                    <option value="{{each_proof.name}}">{{each_proof.name}}</option>
                    {% endfor %}
            </select><br>
            <label for="propt" class="custom-file-upload required" id="upload-file-msg"><b>Upload Photo ID Proof:</b></label>
            <input type="file" id="myFile5" name="aadhar_card_img" class="file_type_info" accept=".jpg,.jpeg,.png" onchange="validateFileType(this)" required>
            </div>
            <!-- <label for="propt"><b>Adhar Card:</b></label>
            <input type="file" id="myFile5" name="aadhar_card_img" accept=".jpg,.jpeg,.png" onchange="validateFileType(this)"><br><br>
			</div> -->

			    <div class="personal_details">
            <label for="dest" class="required"><b>Destination Address:</b></label>
            <input type="text" style="height:30px;" id="destination_details" name="destination_details" required><br>
			</div>
<!--            <label for="Vehicle" class="required"><b>Enter Vehicle Details:</b></label><br>-->
<!--            &lt;!&ndash; <input type="radio" onclick="myInput " id="y" name="option" value="yes" required> &ndash;&gt;-->
<!--            <input type="radio" id="y" name="option" value="yes" required>-->
<!--            <label for="yes">Yes</label><br>-->
<!--            <input type="radio" id="n" name="option" value="no">-->
<!--            <label for="no">No</label><br>-->
            <div id="veh">
                <label for="veh_reg" class="required"><b>Vehicle Registration Number:</b></label>
                <input type="text" style="height:30px;" name="veh_reg" class="veh_details" >
                <label for="driver_name" class="required"><b>Name of the driver:</b></label>
            <input type="text" style="height:30px;" name="driver_name" class="veh_details">
            <label for="phn" class="required"><b>Phone Number of the Driver:</b></label>
            <input type="text" style="height:30px;" name="phn" max="10" class="veh_details"  pattern="[6-9]{1}[0-9]{9}" title="qwert" oninvalid = "this.setCustomValidity(&apos;Please enter details&apos;)" oninput = "setCustomValidity(&apos;&apos;);NumberCheck(this);" onchange = "setCustomValidity(&apos;&apos;);">
            <label for="mode" class="required"><b>Vehicle Used:</b></label>
            <input type="text" style="height:30px;" name="mode" class="veh_details">
<!--             <div class="file_upload">
            <label for="lic_img" class="required"><b>License Image:</b></label>
            <input type="file" id="myFile" name="lic_img" class="file_type_info" accept=".jpg,.jpeg,.png" onchange="validateFileType(this)" class="veh_details">
            </div> -->
            </div>

			<div class="file_upload">
            <label for="sign" class="required"  ><b >Digital Signature:</b></label>
            <input type="file" id="myFile" name="signature_img" class="file_type_info" accept=".jpg,.jpeg,.png" onchange="validateFileType1(this)" required>
			</div>
			

            <hr>
			<br>
            <div>
            <button type="submit" class="save btn" id="save_btn">Submit</button>
            <button style="margin-right:10px;" type="submit" class="btn btn-danger cancel btn" onclick="history.back()" >Cancel</button></div>
			<br>
			<br>
        </div>


    </form>

    <div id="myModal2" class="modal modal-md">
          <!-- <span class="close cursor" onclick="closeModal2()">&times;</span> -->
          <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content " id="myModal2content">

            <div class="modal-header bg-warning">
            <h5 class="modal-title">Warning Message!</h5>
            <button type="button" class="close" data-dismiss="modal" onclick="closeModal2()" aria-label="Close">
              <!-- <span aria-hidden="true">&times;</span> -->
            </button>
            </div>
            <div class="modal-body">
            <p>Application submitted successfully</p>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="closeModal2()">Close</button>
            </div>

          </div>

          </div>
        </div>
<!-- <div id="myModal3" class="modal"> -->
    <div id ="map_content" class="modal">
   <!-- <span class="close cursor" onclick="closeModal2()">&times;</span> -->
  <div class="modal-content" id="myModal3content">
        
           {% include 'my_app/tigram/show_map.html' %} 
        
        
         <input class="btn btn-primary" type="button"  value="Close Map" onclick="closeModal3()">
         <br>
      </div>
    </div>
<!-- <input type="button" value="Update" id="update-btn"> -->
        <!-- <input type="button" id="add-more-log" value="Add More" /> -->
<script>

    function validateBreadth(input) {
    var value = parseFloat(input.value);
    if (value < 75) {
        input.setCustomValidity('Minimum value should be 75cm');
    } else {
        input.setCustomValidity('');
    }
    }

    var breadthInputs = document.querySelectorAll("input[name='breadth[]']");
    breadthInputs.forEach(function (input) {
        input.addEventListener("input", function () {
            NumberCheck(input);
            validateBreadth(input);
        });

        input.addEventListener("blur", function () {
            validateBreadth(input);
        });

        input.addEventListener("invalid", function () {
            validateBreadth(input);
        });
    });
</script>
</body>
        <!-- <script>M.toast({html: "{{message}}", classes: 'green rounded', displayLength:2000});</script> -->
<script>
    function openModal2() {
  document.getElementById("myModal2").style.display = "block";
}
    function closeModal2(){
  document.getElementById("myModal2").style.display = "none";
}
 function openModal3() {
  document.getElementById("map_content").style.display = "block";
}
    function closeModal3(){
  document.getElementById("map_content").style.display = "none";
}
if ('{{transit_pass_exist}}' == 'True'){
        $('.couldapprove').hide( );
        // $("#reason").hide();
    }

$("input[name='log_option']").on('change',function(){
    if($("input[name='log_option']:checked").val()=='no'){
        $(".error_filldetails").html("");
        $('#save_btn').prop('disabled', false);
    }

});
$("input[name='trees_cut']").on('change',function(){
    if($("input[name='trees_cut']:checked").val()=='no'){
        $(".error_filldetails").html("");
        $('#save_btn').prop('disabled', false);
    }
    
});
$('#tab').focusout(function(e){
    var checked_values=[];
    $("input:checkbox[class='chk_species']:checked").each(function (event) {
    checked_values.push($(this).val());
    });
    
    // alert(checked_values);
    var species_values = $("select[name='species[]']")
                        .map(function(){
                            // console.log(this);
                            return $(this).find(":selected").val();
                            }).get();
    if($("input[name='log_option']:checked").val()=='yes'){


       if(($(checked_values).not(species_values).length === 0 && $(species_values).not(checked_values).length === 0)){
        // alert('UnMatched!');
        console.log('Done!');
        // $(".error_filldetails").html("");
        // $('#save_btn').prop('disabled', false);
        var row_len=$('#myBody tr').length;
        var treepl=$('#treep').val();
        if( treepl <= row_len){
        $(".error_filldetails").html("");
        $('#save_btn').prop('disabled', false);
        }
        else{
                $(".error_filldetails").html("Number of logs must not be less than total trees proposed!").css({'color':'red'});
            $('#save_btn').prop('disabled', true);
        }
        // event.stopImmediatePropagation();
       }
       else{
        // alert(focus);
            console.log('Not Done!');
            $(".error_filldetails").html("Add log details for all tree species!").css({'color':'red'});
            $('#save_btn').prop('disabled', true);
            // return true;
            // console.log('Done!');
           }
    }
    else {
        console.log('done');
        $(".error_filldetails").html("");
        $('#save_btn').prop('disabled', false);
    }

});
$("#tab").focusin(function(){
         $(".error_filldetails").html("");
      });
$('#treep').on('change',function(){
    $("#form1-form input:checkbox").prop('checked',false);    
});

$("#form1-form input[type='checkbox']").on('change', function(e) {
    var limit = $('#treep').val();
    // alert(limit);
    //alert($(this).siblings(':checked').length);
    if(isNaN(limit)==true || limit<1 || limit ==''){
    swal('TIGRAM',"Enter Valid Number of trees proposed to be cut.");
        //alert('Enter Valid Number of trees proposed to be cut.');
        this.checked = false;
    } 
    
    else if($('input[type="checkbox"]:checked').length > limit) {
    //else if($(this).siblings(':checked').length >= limit){
    swal('TIGRAM','You can only select '+ limit +' species');
       // alert('You can only select '+ limit +' species');
        this.checked = false;
   }
});

$(document).ready(function(){
                    $(".save_btn").prop("disabled",false);
                    flag = 0;

                    $(".italize_species").html(function(i, h){
                            return h.replace(/\(([^\)]+)\)/, "(<i>$1</i>)");
                    });
                    // $('.file_type_info').after('<label>(.jpg,.jpeg,.png)</label>');
                    $('.file_type_info').after('<label>( .jpg,.jpeg,.png)</label>');
                    // $('.file_type_info').on('change',function(){

                    // });
                        $('#photo_proof_select').on('change',function(){
                    if($('#photo_proof_select').val()==''){
                    // $("input[name='photo_proof_no']").hide();
                    $(".photo_file_upload").hide();
                    }
                    else{
                    // $("input[name='photo_proof_no']").attr('placeholder','Enter number of '+ $('#photo_proof_select').val());
                    // $("input[name='photo_proof_no']").show();
                    $(".photo_file_upload").show();
                    }
                    });
                    // $('.length ,.breadth').on('change', function() {
                    $(document).on('change','.length ,.breadth', function() {

                    var selectedText = $(this).val();
                    var $this = $(this).parent().parent();
                    var rowlength =$($this).children().children('.length').val();
                    var rowbreadth =$($this).children().children('.breadth').val();
                    // alert($($this).children().children('.length').val()+$($this).children().children('.breadth').val());

                    $($this).children().children('.volume').val(calVol(rowlength,rowbreadth));
                    });
                });
    function validateFileType($this){
        // var fileName = document.getElementById("myFile1").value;
        var fileName = $($this).val();
        console.log(fileName,'fileName');
        var idxDot = fileName.lastIndexOf(".") + 1;
        var extFile = fileName.substr(idxDot, fileName.length).toLowerCase();
        if (extFile=="jpg" || extFile=="jpeg" || extFile=="png"){
                $('#save_btn').prop('disabled', false);
                //save_btn.style.background = 'blue';
            // alert('uploaded succesfully!');
        }else{


        document.getElementById('myFile5').value = ''

            swal('TIGRAM',"Only jpg/jpeg and png files are allowed!");
        }

        }

        function validateFileType1($this){
        // var fileName = document.getElementById("myFile1").value;
        var fileName = $($this).val();
        console.log(fileName,'fileName');
        var idxDot = fileName.lastIndexOf(".") + 1;
        var extFile = fileName.substr(idxDot, fileName.length).toLowerCase();
        if (extFile=="jpg" || extFile=="jpeg" || extFile=="png"){
                $('#save_btn').prop('disabled', false);
                //save_btn.style.background = 'blue';
            // alert('uploaded succesfully!');
        }else{


        document.getElementById('myFile').value = ''

            swal('TIGRAM',"Only jpg/jpeg and png files are allowed!");
        }

        }

                var myInput = document.getElementById("y");
                var myInputn = document.getElementById("n")

                myInput.onfocus = function () {
                    document.getElementById("veh").style.display = "block";
                    
                    myInputn.onfocus = function () {
                        document.getElementById("veh").style.display = "none";
                    
                        function myFunction() {
                            document.getElementById("fa fa-plus-square-o").style.display = "block";
                        }
                    }
                }
                function calVol(length,breadth)
                {
                    // var volume = 3.14*length*breadth*breadth ;
                    var volume= length*(breadth/4)**2;
                    return volume;
                }
                function validateLat($this){
                    var lat = $($this).val();
                    if (lat < -90 || lat > 90) {
                    swal('TIGRAM',"Latitude must be between -90 and 90 degrees inclusive.");
                    //alert("Latitude must be between -90 and 90 degrees inclusive.");
                    $('#save_btn').prop('disabled', true);
                    }
                    else if (lat == "") {
                    swal('TIGRAM',"Enter a valid Latitude!");
                    //alert("Enter a valid Latitude!");
                    $('#save_btn').prop('disabled', true);
                    }
                    else{
                     $('#save_btn').prop('disabled', false);   
                    }
                }
                function validateLng($this){
                    var lng = $($this).val();
                    if (lng < -180 || lng > 180) {
                    swal('TIGRAM',"Longitude must be between -180 and 180 degrees inclusive.");
                    //alert("Longitude must be between -180 and 180 degrees inclusive.");
                    $('#save_btn').prop('disabled', true);
                    // $('#save_btn').hide();
                    }
                    else if (lng == "") {
                    swal('TIGRAM','Enter a valid Longitude!');
                    //alert("Enter a valid Longitude!");
                    $('#save_btn').prop('disabled', true);
                    }
                    else{
                     $('#save_btn').prop('disabled', false);   
                    }
                }


                $(document).ready(function(){
                    $('.view_log').hide();
                    $('#show_log').on('click',function(e){
                        e.preventDefault();
                        var species_values = $("select[name='species[]']")
                        .map(function(){
                            console.log(this);
                            return $(this).find(":selected").val();
                            }).get();
                        // alert(species_values);
                        var length_values = $("input[name='length[]']")
                        .map(function(){return $(this).val();}).get();
                        // alert(length_values);
                        var breadth_values = $("input[name='breadth[]']")
                        .map(function(){return $(this).val();}).get();
                        var volume_values = $("input[name='volume[]']")
                        .map(function(){return $(this).val();}).get();
                        var latitude_values = $("input[name='latitude[]']")
                        .map(function(){return $(this).val();}).get();
                        var longitude_values = $("input[name='longitude[]']")
                        .map(function(){return $(this).val();}).get();

                    var show_log="";
                    for(var iter=0;iter<species_values.length;iter++){

                        show_log +='<div class="row">';
                        show_log +='<div class="cell serial">'+parseInt(iter+1)+'</div>';
                        show_log +='<div class="cell species_view ">'+species_values[iter]+'</div>';
                        show_log +='<div class="cell">'+length_values[iter]+'</div>';
                        show_log +='<div class="cell">'+breadth_values[iter]+'</div>';
                        show_log +='<div class="cell">'+volume_values[iter]+'</div>';
                        show_log +='<div class="cell">'+latitude_values[iter]+'</div>';
                        show_log +='<div class="cell">'+longitude_values[iter]+'</div>';
                        show_log +='</div>';

                    }
                    $('#log_details').empty();
                    $('#log_details').append(show_log);
                        $('.view_log').show();



                    });
                });
                function myFunction() {
  var x = document.getElementById("snackbar");
  x.className = "show";
  setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
}
// if(messages){
myFunction();
            </script>
<script>
 $(document).ready(function(){
           $("#photo_proof_select").select2();

  });
</script>

<!-- {% if messages %}
        {% for message in messages %}
        <script type="text/javascript">
            openModal2();
        </script>
        {% endfor %}
{% else %}
<script type="text/javascript">
            closeModal2();
        </script>
 {% endif %} -->
 
</html>
{% endblock %}